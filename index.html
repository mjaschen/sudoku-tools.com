<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Sudoku Tools - Killer Cage Calculator</title>
    <meta name="description" content="Calculate all possible combinations for Killer Cages and Region Sums - exclude digits if needed!"/>
    <meta property="og:url" content="https://sudoku-tools.com"/>
    <meta property="og:title" content="Sudoku Tools - Killer Cage and Region Sums Calculator"/>
    <meta property="og:description" content="Calculate all possible combinations for Killer Cages and Region Sums - exclude digits if needed!" />
    <meta property="og:image" content="https://sudoku-tools.com/screenshot.jpg"/>
    <meta property="og:image:url"  content="https://sudoku-tools.com/screenshot.jpg"/>
    <meta property="twitter:image" content="https://sudoku-tools.com/screenshot.jpg"/>

    <script src="alpine.js" defer></script>
    <script defer data-domain="sudoku-tools.com" src="https://stats.m11n.de/js/script.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="favicon.png">
</head>
<body class="">
    <div class="mx-auto lg:w-3/4 2xl:w-1/2" x-data="killercage">

        <h1 class="m-3 p-3 bg-slate-100 text-center text-2xl text-pink-600 font-bold -rotate-1 md:-rotate-[0.5deg] border-dashed border-2 border-slate-700 relative">
            Killer Cage Calculator &amp; Sudoku&nbsp;Sums
            <span x-text="randomSum" class="absolute top-[-3px] left-[2px] text-base text-slate-700 font-normal"></span>
        </h1>

        <p class="px-3 my-4 text-sm">Please select size of Killer Cage to show all possible combinations. Certain digits can be excluded or marked as required afterwards. ➡️ <a class="underline" href="/6x6-sums.html">Calculator for 6x6 Sudokus</a></p></p>

        <div class="mb-6">
            <h2 class="px-3 mb-3 text-lg">Size of Killer Cage / Number of Digits</h2>
            <div class="flex flex-row justify-between w-full gap-1 px-3 mb-3 md:gap-2">
                <template x-for="digit in digits">
                    <div class="px-2 py-2 text-xl text-center border border-pink-600 rounded-full cursor-pointer basis-1/9 grow shrink-0 text-slate-700 hover:bg-pink-400 hover:text-white" @click="selected = digit" :class="buttonClassSelected(digit)" x-text="digit"></div>
                </template>
            </div>
        </div>

        <div class="flex flex-row flex-wrap mb-6">
            <div class="basis-full sm:basis-1/2">
                <h2 class="px-3 mb-3 text-lg">Allowed Digits</h2>
                <div class="flex flex-row justify-between w-full gap-1 px-3 mb-3 md:gap-2">
                    <template x-for="digit in digits">
                        <div class="px-2 py-2 text-xl text-center border border-pink-400 rounded-full cursor-pointer basis-1/9 grow shrink-0 text-slate-700 hover:bg-pink-200" @click="allowed[digit] = !allowed[digit]" :class="buttonClassAllowed(digit)" x-text="digit"></div>
                    </template>
                </div>
            </div>
            <div class="basis-full sm:basis-1/2">
                <h2 class="px-3 mb-3 text-lg">Required Digits</h2>
                <div class="flex flex-row justify-between w-full gap-1 px-3 mb-3 md:gap-2">
                    <template x-for="digit in digits">
                        <div class="px-2 py-2 text-xl text-center border border-pink-400 rounded-full cursor-pointer basis-1/9 grow shrink-0 text-slate-700 hover:bg-pink-200" @click="required[digit] = !required[digit]" :class="buttonClassRequired(digit)" x-text="digit"></div>
                    </template>
                </div>
                <div class="flex justify-end gap-1 px-3 mb-2 text-sm flex-nowrap">
                    <div class="block cursor-pointer border-pink-400 px-1.5 rounded-full border hover:bg-pink-200" :class="requiredOperator === 'AND' && 'bg-pink-300'" @click="requiredOperator = 'AND'">all of selected</div>
                    <div class="block cursor-pointer border-pink-400 px-1.5 rounded-full border hover:bg-pink-200" :class="requiredOperator === 'OR' && 'bg-pink-300'" @click="requiredOperator = 'OR'">at least one of selected</div>
                </div>
            </div>
        </div>

        <div class="flex flex-row justify-between mb-3">
            <h2 class="pl-3 text-lg">Possible Combinations</h2>
            <div class="pr-3" x-show="selected != 0">
                <button @click="selected = 0" type="button" class="rounded-full bg-indigo-600 px-2.5 py-1 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Reset</button>
            </div>
        </div>

        <p class="px-3 mb-3 text-sm" x-show="selected == 0"><span class="bg-yellow-200 px-1 py-0.5">Please select size and configuration of Killer Cage with buttons above.</span></p>

        <div class="px-3 mb-6 overflow-x-scroll text-sm">
            <template x-for="(digitGroups, sum) in combinations">
                <div class="flex gap-2 mb-1">
                    <span class="font-bold text-right text-pink-700 basis-6 shrink-0" x-text="sum"></span>
                    <span class="border-b">
                        <template x-for="digits in digitGroups">
                            <span class="mr-3 tracking-wide select-all hover:bg-pink-200" x-text="digits.join('')"></span>
                        </template>
                    </span>
                </div>
            </template>
            </ul>
        </div>

        <footer class="flex justify-center py-3 text-xs align-middle bg-slate-700 text-slate-100">
            <div>
                <a class="hover:underline" href="impressum.html">Imprint</a> &centerdot; <a class="hover:underline" href="datenschutz.html">Privacy</a>
            </div>
        </footer>
        <script>
            function getCombinations(sum, digits) {
                const results = [];

                function findCombinations(remainingSum, index, combination) {
                    if (remainingSum === 0) {
                        results.push(combination);
                        return;
                    }

                    for (let i = index; i < digits.length; i++) {
                        const digit = digits[i];
                        if (digit > remainingSum) {
                            break;
                        }
                        if (combination.includes(digit)) {
                            continue;
                        }
                        findCombinations(remainingSum - digit, i, [...combination, digit]);
                    }

                }

                findCombinations(sum, 0, []);

                return results;
            }

            function filterCombinations(combinations, numberOfDigits) {
                return combinations.filter(combination => combination.length === numberOfDigits);
            }

            function applyRequiredDigits(combinations, requiredDigits, operator) {
                if (operator === 'AND') {
                    return combinations.filter(combination => requiredDigits.every(digit => combination.includes(digit)));
                }

                return combinations.filter(combination => requiredDigits.some(digit => combination.includes(digit)));
            }

            document.addEventListener('alpine:init', () => {
                Alpine.data('killercage', () => ({
                    randomSum: Math.floor(Math.random() * 45) + 1,
                    digits: [1, 2, 3, 4, 5, 6, 7, 8, 9],
                    selected: 0,
                    allowed: {
                        1: true,
                        2: true,
                        3: true,
                        4: true,
                        5: true,
                        6: true,
                        7: true,
                        8: true,
                        9: true,
                    },
                    required: {
                        1: false,
                        2: false,
                        3: false,
                        4: false,
                        5: false,
                        6: false,
                        7: false,
                        8: false,
                        9: false,
                    },
                    requiredOperator: 'AND', // 'OR'
                    buttonClassSelected(number) {
                        return {
                            'bg-pink-600 border-pink-800 text-white': this.selected == number
                        }
                    },
                    buttonClassAllowed(number) {
                        return {
                            'bg-pink-300': this.allowed[number] === true
                        }
                    },
                    buttonClassRequired(number) {
                        return {
                            'bg-pink-300': this.required[number] === true
                        }
                    },
                    getAllowedDigits() {
                        let allowedDigits = [];
                        for (let idx in this.allowed) {
                            if (this.allowed[idx]) {
                                allowedDigits.push(parseInt(idx));
                            }
                        }

                        return allowedDigits;
                    },
                    getRequiredDigits() {
                        let requiredDigits = [];
                        for (let idx in this.required) {
                            if (this.required[idx]) {
                                requiredDigits.push(parseInt(idx));
                            }
                        }

                        return requiredDigits;
                    },
                    combinations() {
                        let result = {};
                        const allowedDigits = this.getAllowedDigits();
                        const requiredDigits = this.getRequiredDigits();
                        for (let sum = 1; sum <= 45; sum++) {
                            let combinations = getCombinations(sum, allowedDigits);
                            if (requiredDigits.length > 0) {
                                combinations = applyRequiredDigits(combinations, requiredDigits, this.requiredOperator);
                            }
                            combinations = filterCombinations(combinations, this.selected);
                            if (combinations.length > 0) {
                                result[sum] = combinations;
                            }
                        }

                        return result;
                    }
                }))
            })
        </script>
</body>

</html>
